<html>

<head>
    <title>Spice Factory Admin </title>
    <link rel="stylesheet" href="admin.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"></script>
    <!-- firebase  -->
    <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.slim.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.6.1/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body>
    <script src="admin.js"></script>
    <div id="mySidebar" class="sidebar">
        <a href="javascript:void(0)" class="closebtn" onclick="closeSidebar()">&times;</a>
        <a href="#">Admin</a>
    </div>

    <div id="main">
        <button class="openbtn" onclick="openSidebar()">&#9776; Open Sidebar</button>
        <h1>Admins work</h1>
        <div class="m-4">
            <table class="table">
                <thead>
                    <tr>
                        <th>UserID</th>
                        <th>Customer Name</th>
                        <th>Customer message </th>
                        <th>Date and Time</th>
                        <th>No of peoples</th>
                        <th> Update and delete</th>
                    </tr>
                </thead>
                <tbody id="Tbody1"></tbody>

            </table>
        </div>
    </div>

    <form style="display: none" id="UpdateForm" name="UpdateForm">
        <label for="USERID">user id :</label><br>
        <input type="text" id="USERID" name="fname" value=""><br>
        <label for="CUSTname">Customer name:</label><br>
        <input type="text" id="CUSTname" name="cName" value=""><br><br>
        <label for="CUSTmsg">customer message:</label><br>
        <input type="text" id="CUSTmsg" name="lname" value=""><br><br>
        <label for="DATEandTIME">Date and time :</label><br>
        <input type="text" id="DATEandTIME" name="lname" value=""><br><br>
        <label for="NOofPEOPLES">Number of peoples:</label><br>
        <input type="text" id="NOofPEOPLES" name="lname" value=""><br><br>
        <input type="button" value="update" id="Updating">
        <input type="button" value="Delete" id="Deleting">
    </form>
    <script>

        function Openpopup(userId, cust_name, date, Cust_msg, no_peoples) {
            document.getElementById("UpdateForm").style.display = "block";
            document.getElementById("USERID").value = userId;
            document.getElementById("CUSTname").value = cust_name;
            document.getElementById("DATEandTIME").value = date;
            document.getElementById("CUSTmsg").value = Cust_msg;
            document.getElementById("NOofPEOPLES").value = no_peoples;
        }   
    </script>


    <script type="module">

        var tbody = document.getElementById('Tbody1');

        function AddItemToTable(cust_name, Cust_msg, date, no_peoples, userId) {
            let trow = document.createElement("tr");
            let td1 = document.createElement('td');
            let td2 = document.createElement('td');
            let td3 = document.createElement('td');
            let td4 = document.createElement('td');
            let td5 = document.createElement('td');
            let td6 = document.createElement('td');
            let bt1 = document.createElement('button');

            td1.innerHTML = userId;
            td2.innerHTML = cust_name;
            td3.innerHTML = date;
            td4.innerHTML = Cust_msg;
            td5.innerHTML = no_peoples;
            td6.innerHTML = '<button type="button" id="UpdateDemo" onclick="Openpopup(\'' + userId + '\',\'' + cust_name + '\',\'' + Cust_msg + '\',\'' + date + '\',\'' + no_peoples + '\')">Update</button></a><a href="./updateanddelete.html"><button type="button" id="Update">Delete</button></a>';

            trow.appendChild(td1);
            trow.appendChild(td2);
            trow.appendChild(td3);
            trow.appendChild(td4);
            trow.appendChild(td5);
            trow.appendChild(td6);

            tbody.appendChild(trow);
        }

        function AddAllItemsToTable(user1) {

            tbody.innerHTML = "";
            user1.forEach(element => {
                AddItemToTable(element.Customer_name, element.Date_Time, element.Cust_message, element.No_of_peoples, element.userId)
            });
        }
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.8.3/firebase-app.js'
        import { getDatabase, ref, set, child, onValue, get, push, update } from "https://cdnjs.cloudflare.com/ajax/libs/firebase/9.8.3/firebase-database.min.js";

        // TODO: Replace the following with your app's Firebase project configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDfvglCa7eO_65LfxIyOeQel5b2Izdjs9o",
            authDomain: "restaurantsystem-b01d5.firebaseapp.com",
            databaseURL: "https://restaurantsystem-b01d5-default-rtdb.firebaseio.com",
            projectId: "restaurantsystem-b01d5",
            storageBucket: "restaurantsystem-b01d5.appspot.com",
            messagingSenderId: "475408154352",
            appId: "1:475408154352:web:7c5535bb751ccadc5e0c35"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);

        const db = getDatabase();

        function GetAllDataOnce() {
            const dbRef = ref(getDatabase());
            get(child(dbRef, `users`)).then((snapshot) => {
                if (snapshot.exists()) {
                    console.log(snapshot.val());
                    var user = [];

                    var j = 0;
                    var res = [];
                    for (var i in snapshot.val()) {
                        res[j] = snapshot.val()[i];
                        res[j].userId = i;
                        j++;
                    }
                    AddAllItemsToTable(res);
                }
            });
        }
        window.onload = GetAllDataOnce;

        document.getElementById('Updating').onclick = function () {
            var userId = document.getElementById("USERID").value;
            var Customer_name = document.getElementById('CUSTname').value;
            var Date_Time = document.getElementById('DATEandTIME').value;
            var Cust_message = document.getElementById('CUSTmsg').value;
            var No_of_peoples = document.getElementById('NOofPEOPLES').value;
            writeNewPost(userId, Customer_name, Date_Time, Cust_message, No_of_peoples);
        }

        function writeNewPost(userId, Customer_name, Date_Time, Cust_message, No_of_peoples) {
            // A post entry.
            const postData = {
                uid: userId,
                Customer_name: Customer_name,
                Date_Time: Date_Time,
                Cust_message: Cust_message,
                No_of_peoples: No_of_peoples,
            };
            const updates = {};

            updates['/users/' + userId] = postData;

            return update(ref(db), updates);
        }



    </Script>

</body>

</html>